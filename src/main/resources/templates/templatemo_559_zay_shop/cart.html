<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/cart.css">
</head>
<body>
<div class="container">
    <div class="card">
        <div class="row">
            <div class="col-md-8 cart">
                <div class="title">
                    <div class="row">
                        <div class="col">
                            <h4><b>Carrito de Compras</b></h4>
                        </div>
                    </div>
                </div>
                <div class="row border-top border-bottom" th:each="producto, iterStat : ${productos}">
                    <div class="row main align-items-center">
                        <td><img th:src="@{${producto.image}}" alt="Imagen del producto" width="50" height="50"></td>
                        <div class="col">
                            <div class="row text-muted">Producto</div>
                            <div class="row" th:text="${producto.title}"></div>
                        </div>
                        <div class="col">
                            <button class="btn btn-danger" th:data-index="${iterStat.index}" onclick="removeFromCart(this)">Eliminar</button>
                        </div>
                        <div class="col text-right" th:text="${producto.price}"></div>
                    </div>
                </div>
                <div class="back-to-shop"><a href="#" th:href="@{/}">&leftarrow; Volver a la tienda</a></div>
            </div>
            <div class="col-md-4 summary">
                <div>
                    <h5><b>Resumen</b></h5>
                </div>
                <hr>
                <div class="row">
                    <div class="col">Total</div>
                    <div class="col text-right cart-total" th:text="${total}">â‚¬</div>
                </div>
                <div class="row">
                    <div class="col">
                        <a href="/checkout" class="btn btn-primary" id="checkout-btn">Proceder al pago</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function removeFromCart(buttonElement) {
        var index = buttonElement.getAttribute('data-index');
        fetch('/cart/' + index, {
            method: 'DELETE'
        })
        .then(function(response) {
            if (response.ok) {
                location.reload();
            } else {
                alert('Error al eliminar el producto del carrito');
            }
        });
    }

    function redirectToCheckout() {
    let cartTotal = document.querySelector('.summary .cart-total').textContent;
    let encodedTotal = encodeURIComponent(cartTotal);
    window.location.href = 'checkout.html?total=' + encodedTotal;
}
</script>
</body>
</html>



